<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Chatbot FAQ Prototype</title>
</head>
<body>

<!-- Chatbot flottant -->
<div id="chatbot" style="position:fixed;bottom:20px;right:20px;width:300px;font-family:Arial,sans-serif;z-index:999;">
  <div id="chat-header" style="background:#007bff;color:white;padding:10px;border-radius:10px 10px 0 0;cursor:pointer;">
    Chat FAQ
  </div>
  <div id="chat-body" style="display:none;background:#fff;border:1px solid #007bff;border-radius:0 0 10px 10px;max-height:400px;overflow-y:auto;padding:10px;">
    <div id="chat-messages" style="height:200px;overflow-y:auto;margin-bottom:10px;"></div>
    <input type="text" id="chat-input" placeholder="Posez votre question..." style="width:70%;padding:5px;">
    <button id="send-btn" style="padding:5px 10px;background:#007bff;color:white;border:none;border-radius:5px;cursor:pointer;">Envoyer</button>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
  // ⚡ 1️⃣ Initialiser Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBX57S6LD4OpIF3cV5seuFOS730zDQUFnM",
    authDomain: "info-bot-b92ae.firebaseapp.com",
    databaseURL: "https://info-bot-b92ae-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "info-bot-b92ae",
    storageBucket: "info-bot-b92ae.firebasestorage.app",
    messagingSenderId: "721853060361",
    appId: "1:721853060361:web:996e7fa3d12ddcba10efd8"
  };
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  // ⚡ 2️⃣ Éléments DOM
  const chatHeader = document.getElementById("chat-header");
  const chatBody = document.getElementById("chat-body");
  const chatMessages = document.getElementById("chat-messages");
  const chatInput = document.getElementById("chat-input");
  const sendBtn = document.getElementById("send-btn");

  // Toggle chat open/close
  chatHeader.addEventListener("click", () => {
    chatBody.style.display = chatBody.style.display === "none" ? "block" : "none";
  });

  // ⚡ 3️⃣ Envoyer un message
  sendBtn.addEventListener('click', sendMessage);
  chatInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') sendMessage(); });

  function sendMessage(){
    const msg = chatInput.value.trim();
    if(!msg) return;

    // Récupérer toutes les FAQ
    database.ref('faq').once('value').then(snapshot => {
      const faqs = snapshot.val();
      let found = false;

      for(const key in faqs){
        const item = faqs[key];
        // Matching mot-clé
        if(item.keywords.some(kw => msg.toLowerCase().includes(kw.toLowerCase()))){
          chatMessages.innerHTML += `<div><strong>Bot :</strong> ${item.response}</div>`;
          found = true;
          break;
        }
      }

      // Si pas de correspondance → stocker pour admin
      if(!found){
        const newMsgRef = database.ref('messages').push();
        newMsgRef.set({
          text: msg,
          status: "pending",
          timestamp: Date.now()
        });
        chatMessages.innerHTML += `<div><strong>Bot :</strong> Votre question a été transmise à un administrateur.</div>`;
      }

      chatMessages.scrollTop = chatMessages.scrollHeight;
    });

    chatInput.value = "";
  }

  // ⚡ 4️⃣ Écouter les réponses admin en temps réel
  database.ref('adminResponses').on('child_added', snapshot => {
    const item = snapshot.val();
    if(item && item.userId){ // userId pour savoir à quel client envoyer
      chatMessages.innerHTML += `<div><strong>Admin :</strong> ${item.text}</div>`;
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
  });
</script>

</b
