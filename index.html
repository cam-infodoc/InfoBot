<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Chatbot FAQ InfoDoc</title>
<style>
  #chatbot { position: fixed; bottom: 20px; right: 20px; width: 300px; font-family: Arial,sans-serif; z-index: 999; }
  #chat-header { background: #007bff; color: white; padding: 10px; border-radius: 10px 10px 0 0; cursor: pointer; }
  #chat-body { display: none; background: #fff; border: 1px solid #007bff; border-radius: 0 0 10px 10px; max-height: 400px; overflow-y: auto; padding: 10px; }
  #chat-messages { height: 200px; overflow-y: auto; margin-bottom: 10px; }
  #chat-input { width: 70%; padding: 5px; }
  #send-btn { padding: 5px 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
  .chat-msg { margin-bottom: 8px; }
  .chat-msg strong { display: block; }
</style>
</head>
<body>

<div id="chatbot">
  <div id="chat-header">Chat FAQ</div>
  <div id="chat-body">
    <div id="chat-messages"></div>
    <input type="text" id="chat-input" placeholder="Posez votre question...">
    <button id="send-btn">Envoyer</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script>
// üîπ Initialiser Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBX57S6LD4OpIF3cV5seuFOS730zDQUFnM",
  authDomain: "info-bot-b92ae.firebaseapp.com",
  databaseURL: "https://info-bot-b92ae-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "info-bot-b92ae",
  storageBucket: "info-bot-b92ae.firebasestorage.app",
  messagingSenderId: "721853060361",
  appId: "1:721853060361:web:996e7fa3d12ddcba10efd8"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

const chatHeader = document.getElementById('chat-header');
const chatBody = document.getElementById('chat-body');
const chatMessages = document.getElementById('chat-messages');
const chatInput = document.getElementById('chat-input');
const sendBtn = document.getElementById('send-btn');

chatHeader.addEventListener('click', () => {
  chatBody.style.display = chatBody.style.display === 'none' ? 'block' : 'none';
});

sendBtn.addEventListener('click', sendMessage);
chatInput.addEventListener('keypress', e => { if(e.key==='Enter') sendMessage(); });

function sendMessage(){
  const msg = chatInput.value.trim();
  if(!msg) return;

  chatMessages.innerHTML += `<div class='chat-msg'><strong>Vous :</strong> ${msg}</div>`;

  database.ref('faq').once('value').then(snapshot => {
    const faqs = snapshot.val();
    let found = false;

    for(const key in faqs){
      const item = faqs[key];
      if(item.message && item.message.keywords && Array.isArray(item.message.keywords) &&
         item.message.keywords.some(kw => msg.toLowerCase().includes(kw.toLowerCase()))) {
        chatMessages.innerHTML += `<div class='chat-msg'><strong>Bot :</strong> ${item.message.response}</div>`;
       found = true;
       break;
  }
}

      }
    }

    if(!found){
      database.ref('messages').push({ text: msg, status: 'pending', timestamp: Date.now() });
      chatMessages.innerHTML += `<div class='chat-msg'><strong>Bot :</strong> Votre question a √©t√© transmise √† un administrateur.</div>`;
    }

    chatMessages.scrollTop = chatMessages.scrollHeight;
  });

  chatInput.value='';
}

database.ref('adminResponses').on('child_added', snapshot => {
  const item = snapshot.val();
  if(item && item.userId){
    chatMessages.innerHTML += `<div class='chat-msg'><strong>Admin :</strong> ${item.text}</div>`;
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }
});
</script>
</body>
</html>

