<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chatbot InfoDoc</title>
<style>
  body {
    background: #000;
    margin: 0;
    height: 100vh;
    overflow: hidden;
    font-family: 'Montserrat', sans-serif;
  }
  #chatbot {
    position: fixed;
    bottom: 30px;
    right: 30px;
    z-index: 999;
  }
  #chat-bubble {
    width: 70px;
    height: 70px;
    background: rgba(30,30,30,0.7);
    backdrop-filter: blur(10px);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 28px;
    cursor: pointer;
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
    transition: all 0.3s ease;
  }
  #chat-bubble:hover {
    box-shadow: 0 0 20px rgba(0,150,255,0.6);
  }
  #chat-window {
    display: none;
    position: absolute;
    bottom: 90px;
    right: 0;
    width: 200px;
    height: 250px;
    background: rgba(20,20,20,0.7);
    backdrop-filter: blur(15px);
    border-radius: 15px;
    border: 1px solid rgba(0,150,255,0.3);
    box-shadow: 0 0 20px rgba(0,150,255,0.2);
    overflow: hidden;
    color: white;
  }
  #chat-header {
    background: rgba(0,150,255,0.2);
    padding: 10px;
    text-align: center;
    font-weight: bold;
    border-bottom: 1px solid rgba(0,150,255,0.4);
  }
  #chat-messages {
    padding: 10px;
    height: 310px;
    overflow-y: auto;
  }
  .msg {
    margin-bottom: 10px;
  }
  .msg strong {
    display: block;
    color: #00aaff;
  }
  #chat-input-area {
    display: flex;
    border-top: 1px solid rgba(0,150,255,0.4);
  }
  #chat-input {
    flex: 1;
    padding: 10px;
    background: transparent;
    color: white;
    border: none;
    outline: none;
  }
  #send-btn {
    background: rgba(0,150,255,0.5);
    border: none;
    color: white;
    padding: 10px 15px;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  #send-btn:hover {
    background: rgba(0,150,255,0.8);
  }
</style>
</head>
<body>
<div id="chatbot">
  <div id="chat-bubble">ðŸ’¬</div>
  <div id="chat-window">
    <div id="chat-header">ðŸ¤–| Info-Bot</div>
    <div id="chat-messages"></div>
    <div id="chat-input-area">
      <input id="chat-input" type="text" placeholder="Ã‰crivez votre message...">
      <button id="send-btn">âž¤</button>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script>
// ðŸ”¹ Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBX57S6LD4OpIF3cV5seuFOS730zDQUFnM",
  authDomain: "info-bot-b92ae.firebaseapp.com",
  databaseURL: "https://info-bot-b92ae-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "info-bot-b92ae",
  storageBucket: "info-bot-b92ae.firebasestorage.app",
  messagingSenderId: "721853060361",
  appId: "1:721853060361:web:996e7fa3d12ddcba10efd8"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ðŸ”¹ SÃ©lecteurs
const bubble = document.getElementById('chat-bubble');
const windowBox = document.getElementById('chat-window');
const messages = document.getElementById('chat-messages');
const input = document.getElementById('chat-input');
const sendBtn = document.getElementById('send-btn');

// ðŸ”¹ Identification utilisateur
let userId = localStorage.getItem('chatUserId');
if (!userId) {
  userId = 'user_' + Date.now() + '_' + Math.floor(Math.random()*1000);
  localStorage.setItem('chatUserId', userId);
}

// ðŸ”¹ Ouverture / fermeture chat
bubble.addEventListener('click', () => {
  windowBox.style.display = windowBox.style.display === 'none' ? 'block' : 'none';
});

// ðŸ”¹ Fonctions
function appendMsg(sender, text) {
  messages.innerHTML += `<div class="msg"><strong>${sender} :</strong> ${text}</div>`;
  messages.scrollTop = messages.scrollHeight;
}

function matchesKeywords(msg, keywords) {
  const lower = msg.toLowerCase();
  return keywords.some(kw => lower.includes(kw.toLowerCase()));
}

// ðŸ”¹ Envoi message utilisateur
sendBtn.addEventListener('click', sendMessage);
input.addEventListener('keypress', e => { if(e.key === 'Enter') sendMessage(); });

function sendMessage() {
  const msg = input.value.trim();
  if(!msg) return;

  appendMsg('Vous', msg);
  input.value = '';

  // ðŸ” VÃ©rification des FAQ
  db.ref('/').once('value').then(snapshot => {
    const data = snapshot.val();
    let found = false;

    for (const key in data) {
      const item = data[key];
      if (item.message && Array.isArray(item.message.keywords)) {
        console.log("ðŸ§© VÃ©rif:", key, item.message.keywords); // Debug console
        if (matchesKeywords(msg, item.message.keywords)) {
          appendMsg('Bot', item.message.response);
          found = true;
          break;
        }
      }
    }

    if (!found) {
      db.ref('messages').push({ text: msg, status: 'pending', timestamp: Date.now() });
      appendMsg('Bot', 'Votre question a Ã©tÃ© transmise Ã  un administrateur.');
    }
  });
}

// ðŸ”¹ Ã‰coute rÃ©ponses admins en temps rÃ©el
db.ref('adminResponses').on('child_added', snapshot => {
  const item = snapshot.val();
  if(item && item.userId === userId){
    appendMsg('Admin', item.text);
  }
});
</script>

</body>
</html>


